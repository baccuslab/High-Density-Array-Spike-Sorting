%  version 0.1  -27.11.03- Clemens.Boucsein@biologie.uni-freiburg.de
%
%  uses spike2_SON toolbox
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% use: [fileInfo] = GetFileInformation(filename)
% (ignore 'chanInfo', since it contains only the chanInfo of the last waveform 
% data channel accessed) CB 19.8.04
%
% GetFileInformation extracts the following file parameters from a given
% Spike2-generated data file (*.smr) of the following structure:
%
% fileInfo:
%    fileName: 'D:\Matlab\Test\testfile.smr'
%        date: [1x1 struct]
%    ChanList: [1x9 struct]
%
% fileInfo.date:
%    Detail: [6x1 double]
%    Year: 2003
% where fileInfo.date.Detail (an Example):
%    64
%    48
%    42
%    15
%    28
%    11
% meaning 28th of Nov, 15:42, 48.64 sec
% 
% fileInfo.ChanList:
% 1x9 struct array with fields:
%    number
%    kind
%    title
%    comment
%    phyChan
%    sampleInt
%    scale
%    offset
%    units
% 


%
% open .smr-file generated by Spike2
%

function [fileInfo] = GetFileInformation(filename)
import extern.CED.*;
fid = fopen(filename);
if fid<1
  disp('error reading file');return
end;

%
% read header and measurement parameters 
%

% disp(['reading ', filename,'...'])
smrHeader = SONFileHeader(fid);

fileInfo.fileName = smrHeader.FileIdentifier;
fileInfo.date = smrHeader.timeDate;
fileInfo.ChanList = SONChanList(fid);

for m = 1 : length([fileInfo.ChanList.number])
    if  [fileInfo.ChanList(m).kind] == 1
        ChanNr = fileInfo.ChanList(m).number;
        fileInfo.ChanList(m).sampleInt = SONGetSampleInterval(fid,(ChanNr));
        chanInfo = SONChannelInfo(fid, ChanNr);
        fileInfo.ChanList(m).scale = chanInfo.scale;
        fileInfo.ChanList(m).offset = chanInfo.offset;
        fileInfo.ChanList(m).units = chanInfo.units;
    end
end

fclose(fid);